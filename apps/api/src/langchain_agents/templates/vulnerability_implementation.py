"""
Prompt templates for vulnerability implementation stage.
"""
from langchain.prompts import ChatPromptTemplate, HumanMessagePromptTemplate, SystemMessagePromptTemplate

VULNERABILITY_IMPLEMENTATION_SYSTEM = """You are an expert in implementing secure but intentionally vulnerable code for CTF challenges. Your task is to implement specific security flaws that are educational and exploitable.

Key Considerations:
1. Vulnerability Type & Implementation
2. Exploit Methodology
3. Security Constraints
4. Learning Objectives
5. Validation Requirements

Guidelines:
1. Implement vulnerabilities that teach specific concepts
2. Ensure vulnerabilities are intentional and controlled
3. Create clear exploit paths
4. Document implementation details
5. Consider security implications
6. Validate exploit reliability"""

VULNERABILITY_IMPLEMENTATION_HUMAN = """Implement vulnerabilities for the following CTF challenge code:

Challenge Code:
{challenge_code}

Vulnerability Requirements:
{vulnerability_requirements}

Output STRICT JSON with keys:
{{
  "files": [ {{"path": "relative/path", "content": "updated file content"}} ],
  "exploit_methodology": [str],
  "security_constraints": [str],
  "validation_steps": [str],
  "notes": [str]
}}
Do not include markdown fences or commentary outside JSON."""

vulnerability_implementation_template = ChatPromptTemplate.from_messages([
    SystemMessagePromptTemplate.from_template(VULNERABILITY_IMPLEMENTATION_SYSTEM),
    HumanMessagePromptTemplate.from_template(VULNERABILITY_IMPLEMENTATION_HUMAN)
])

{
  "type": "object",
  "required": [
    "id",
    "title", 
    "track",
    "difficulty",
    "points",
    "time_cap_minutes",
    "mode",
    "flag",
    "hints",
    "artifacts_plan",
    "deliverables",
    "safety_notes"
  ],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9-]{3,64}$",
      "description": "Unique challenge identifier"
    },
    "title": {
      "type": "string",
      "minLength": 3,
      "maxLength": 200,
      "description": "Challenge title"
    },
    "track": {
      "enum": [
        "INTEL_RECON",
        "ACCESS_EXPLOIT", 
        "IDENTITY_CLOUD",
        "C2_EGRESS",
        "DETECT_FORENSICS"
      ],
      "description": "Challenge track/category"
    },
    "difficulty": {
      "enum": ["EASY", "MEDIUM", "HARD", "INSANE"],
      "description": "Challenge difficulty level"
    },
    "points": {
      "type": "integer",
      "minimum": 50,
      "maximum": 1000,
      "description": "Base points for solving"
    },
    "time_cap_minutes": {
      "type": "integer",
      "minimum": 15,
      "maximum": 120,
      "description": "Suggested time limit in minutes"
    },
    "mode": {
      "enum": ["solo", "team"],
      "description": "Individual or team challenge"
    },
    "flag": {
      "type": "object",
      "required": ["type", "format"],
      "properties": {
        "type": {
          "enum": ["dynamic_hmac", "static", "validator"],
          "description": "Flag validation method"
        },
        "format": {
          "type": "string",
          "description": "Flag format template"
        },
        "hmac_inputs": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Inputs for HMAC flag generation"
        },
        "static_value": {
          "type": "string",
          "description": "Static flag value"
        }
      }
    },
    "hints": {
      "type": "array",
      "minItems": 1,
      "maxItems": 5,
      "items": {
        "type": "object",
        "required": ["order", "cost_percent", "text"],
        "properties": {
          "order": {
            "type": "integer",
            "minimum": 1,
            "description": "Hint order (1-based)"
          },
          "cost_percent": {
            "type": "integer",
            "minimum": 1,
            "maximum": 50,
            "description": "Point deduction percentage"
          },
          "text": {
            "type": "string",
            "minLength": 10,
            "maxLength": 500,
            "description": "Hint text"
          }
        }
      }
    },
    "artifacts_plan": {
      "type": "array",
      "minItems": 1,
      "maxItems": 10,
      "items": {
        "type": "object",
        "required": ["operation", "params"],
        "properties": {
          "operation": {
            "enum": [
              "corrupt_png_magic",
              "synthesize_dns_tunnel_csv",
              "make_pcap_beacon",
              "make_edr_json_lolbin",
              "slice_winsec_logs_4769",
              "make_eml_phish",
              "kubeyaml_insecure_mount",
              "iam_policy_overbroad",
              "http_logs_idor",
              "azure_signin_json",
              "pack_zip"
            ],
            "description": "Artifact generation operation"
          },
          "params": {
            "type": "object",
            "description": "Operation-specific parameters"
          },
          "seed": {
            "type": "integer",
            "minimum": 1,
            "maximum": 999999,
            "description": "Deterministic seed for generation"
          }
        }
      }
    },
    "deliverables": {
      "type": "array",
      "minItems": 1,
      "maxItems": 3,
      "items": {
        "type": "object",
        "required": ["type"],
        "properties": {
          "type": {
            "enum": ["notes", "rule", "query", "report"],
            "description": "Deliverable type"
          },
          "subtype": {
            "type": "string",
            "enum": ["sigma", "yara", "kql", "spl", "suricata"],
            "description": "Deliverable subtype"
          }
        }
      }
    },
    "safety_notes": {
      "type": "string",
      "minLength": 10,
      "maxLength": 1000,
      "description": "Safety and operational notes"
    },
    "description": {
      "type": "string",
      "maxLength": 2000,
      "description": "Challenge description/scenario"
    }
  }
}
